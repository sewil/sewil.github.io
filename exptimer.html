<html>
<head>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body style="background-color: black;">
	<div style="background-color: white; padding: 16px; float: left; gap: 8px; display: flex; flex-direction: column;">
		<div>
			<label>Starting exp</label>
			<input id="starting-exp" />
		</div>
		<div>
			<label>End exp</label>
			<input id="ending-exp" />
		</div>
		<div>
			<label>EXP/h</label>
			<input id="exp-rate" disabled />
		</div>
		<div>
			<label>Time</label>
			<input disabled id="time" value="00:00:00"/>
		</div>
		<button id="toggle-timer" onclick="javascript:toggleTimer()">Start timer</button>
		<button id="reset" disabled onclick="javascript:reset()">Reset</button>
		<button id="calculate" disabled onclick="javascript:calculate()">Calculate</button>
	</div>
	<script>
		var startDate = null;
		var timerStarted = false;
		var diffTime = 0;
		var elapsedSeconds = 0;
		var intervalID;
		function updateTimer() {
			var e = getElapsed();
			var h = Math.floor(e / 3600).toString().padStart(2, '0');
			var m = Math.floor((e - (h*3600)) / 60).toString().padStart(2, '0');
			var s = Math.floor(e - (h * 3600) - (m * 60)).toString().padStart(2, '0');
			$('#time').val(h + ':' + m + ':' + s);
		}
		function getElapsed() {
			return elapsedSeconds + diffTime;
		}
		function toggleTimer() {
			if (timerStarted) { // Stopping timer
				stopTimer();
			} else { // Starting timer
				startTimer();
			}
		}
		function startTimer() {
			timerStarted = true;
			$('#toggle-timer').text('Stop timer');
			$('#reset').attr('disabled', false);
			$('#calculate').attr('disabled', false);
			startDate = new Date();
			intervalID = setInterval(function() {
				var now = new Date();
				diffTime = Math.abs(now - startDate) / 1000;
				updateTimer();
			}, 1000);
		}
		function stopTimer() {
			timerStarted = false;
			$('#toggle-timer').text('Start timer');
			clearInterval(intervalID);
			intervalID = null;
			elapsedSeconds += diffTime;
			diffTime = 0;
		}
		function reset() {
			stopTimer();
			$('#calculate').attr('disabled', true);
			$('#reset').attr('disabled', true);
			$('#exp-rate').val('');
			startDate = null;
			elapsedSeconds = 0;
			updateTimer(elapsedSeconds);
		}
		function calculate() {
			var e = getElapsed();
			var exp = $('#ending-exp').val() - $('#starting-exp').val();
			var expRate = exp / (e / 3600);
			$('#exp-rate').val(expRate);
		}
	</script>
</body>

</html>

